<!doctype html>
<html lang="en">
<head>
  <!-- =========================
       SEO BASICS
  ========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monthly Dividend Income Calculator (US & Canada) – Estimate Your Annual & Monthly Payout</title>
  <meta name="description" content="Estimate your monthly and annual dividend income with this free dividend income calculator for US and Canadian investors. Simple, fast, accurate, with optional advanced planning." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://nimrat1000.github.io/dividend-income-calculator/" />

  <!-- Open Graph (optional but nice) -->
  <meta property="og:title" content="Monthly Dividend Income Calculator (US & Canada)" />
  <meta property="og:description" content="Calculate monthly & annual dividend income. Simple mode + advanced planning options (DRIP, growth, contributions)." />
  <meta property="og:type" content="website" />

  <!-- FAQ Schema (helps with Google “People Also Ask”) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How is monthly dividend income calculated?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Monthly dividend income is estimated by multiplying your investment amount by the annual dividend yield and dividing by 12. If you choose a specific payout frequency, the calculator shows a per-payment estimate as well."
        }
      },
      {
        "@type": "Question",
        "name": "How much should I invest to earn $1,000 per month in dividends?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "To earn $1,000/month ($12,000/year), divide $12,000 by your expected dividend yield. Example: at 6% yield, $12,000/0.06 = $200,000."
        }
      },
      {
        "@type": "Question",
        "name": "Is dividend income taxable in the US and Canada?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Often yes, but it depends on the account type and your situation. This tool includes an optional tax-rate estimate, but it’s not tax advice."
        }
      },
      {
        "@type": "Question",
        "name": "What is a good dividend yield?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Many investors consider 3%–7% a common range, but sustainability matters more than yield. Very high yields can be riskier."
        }
      },
      {
        "@type": "Question",
        "name": "Does this calculator include dividend reinvestment (DRIP)?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes—Advanced Mode can simulate reinvestment plus optional dividend growth and annual contributions."
        }
      }
    ]
  }
  </script>

  <style>
    :root{
      --bg: #0b1020;
      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.085);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --border: rgba(255,255,255,0.14);
      --shadow: 0 14px 40px rgba(0,0,0,0.35);
      --radius: 18px;
      --radius2: 14px;
      --good: #19c37d;
      --warn: #ffcc66;
      --bad: #ff6b6b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% 10%, rgba(92,124,250,0.22), transparent 60%),
                  radial-gradient(1100px 600px at 80% 20%, rgba(25,195,125,0.16), transparent 55%),
                  radial-gradient(900px 600px at 55% 90%, rgba(255,204,102,0.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      line-height:1.45;
    }
    a{color:inherit}
    .wrap{
      width:min(1100px, 92vw);
      margin: 38px auto 80px;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 18px;
      margin-bottom: 18px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    h1{
      margin:0;
      font-size: clamp(26px, 3.2vw, 40px);
      letter-spacing: -0.02em;
    }
    .sub{
      margin:0;
      max-width: 72ch;
      color: var(--muted);
      font-size: 15.5px;
    }

    .pillRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
      align-items:center;
      margin-top: 6px;
    }
    .pill{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      padding: 8px 10px;
      border-radius: 999px;
      display:flex;
      gap:8px;
      align-items:center;
      box-shadow: 0 8px 22px rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
    }
    .pill label{
      font-size: 13px;
      color: var(--muted);
      white-space:nowrap;
    }
    .seg{
      display:flex;
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow:hidden;
    }
    .seg button{
      border:0;
      background: transparent;
      color: var(--muted);
      padding: 7px 10px;
      cursor:pointer;
      font-size: 13px;
      transition: 120ms ease;
      white-space:nowrap;
    }
    .seg button.active{
      color: var(--text);
      background: rgba(255,255,255,0.08);
    }
    .seg button:focus{outline:2px solid rgba(255,255,255,0.25); outline-offset:2px;}

    .grid{
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 18px;
      margin-top: 18px;
    }
    @media (max-width: 920px){
      header{flex-direction:column; align-items:stretch;}
      .pillRow{justify-content:flex-start;}
      .grid{grid-template-columns:1fr;}
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .cardHead{
      padding: 16px 18px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
    }
    .cardHead h2{
      margin:0;
      font-size: 16px;
      letter-spacing: -0.01em;
    }
    .tiny{
      font-size: 12.5px;
      color: var(--muted);
    }
    .content{
      padding: 16px 18px 18px;
    }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 620px){
      .form{grid-template-columns:1fr;}
    }
    .field{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .field label{
      font-size: 13px;
      color: var(--muted);
    }
    .inRow{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    input, select{
      width:100%;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.28);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 12px;
      font-size: 14.5px;
      outline:none;
    }
    input:focus, select:focus{
      border-color: rgba(255,255,255,0.32);
      box-shadow: 0 0 0 3px rgba(92,124,250,0.25);
    }
    input[type="range"]{
      padding:0;
      height: 36px;
      background: transparent;
      border: 0;
    }
    .helper{
      font-size: 12.5px;
      color: var(--muted);
    }

    .btnRow{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin-top: 12px;
      align-items:center;
    }
    .btn{
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-size: 13.5px;
      transition: 120ms ease;
    }
    .btn:hover{background: rgba(255,255,255,0.10);}
    .btn.primary{
      background: rgba(92,124,250,0.22);
      border-color: rgba(92,124,250,0.35);
    }
    .btn.primary:hover{background: rgba(92,124,250,0.28);}
    .btn.ghost{
      background: transparent;
    }
    .badge{
      font-size: 12px;
      color: rgba(255,255,255,0.85);
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.18);
      padding: 6px 10px;
      border-radius: 999px;
    }

    .resultGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 6px;
    }
    @media (max-width: 620px){
      .resultGrid{grid-template-columns:1fr;}
    }
    .resultCard{
      background: var(--card2);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      padding: 14px 14px;
      min-height: 84px;
    }
    .resultLabel{font-size: 12.5px; color: var(--muted);}
    .resultValue{
      margin-top: 6px;
      font-size: 22px;
      letter-spacing: -0.02em;
      font-weight: 700;
    }
    .resultNote{
      margin-top: 6px;
      font-size: 12.5px;
      color: var(--muted);
    }

    .advanced{
      display:none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed rgba(255,255,255,0.16);
    }
    .advanced.on{display:block;}

    .tableWrap{
      margin-top: 12px;
      overflow:auto;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width: 620px;
      background: rgba(0,0,0,0.18);
    }
    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      text-align:right;
      font-size: 13px;
      white-space:nowrap;
    }
    th{
      position:sticky;
      top:0;
      background: rgba(0,0,0,0.34);
      color: rgba(255,255,255,0.85);
      font-weight: 650;
    }
    th:first-child, td:first-child{text-align:left;}
    .mutedBlock{
      margin-top: 12px;
      color: var(--muted);
      font-size: 13.5px;
    }

    details{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.04);
      border-radius: 14px;
      padding: 10px 12px;
    }
    details + details{margin-top:10px;}
    summary{
      cursor:pointer;
      font-weight:650;
      color: rgba(255,255,255,0.90);
      list-style:none;
    }
    summary::-webkit-details-marker{display:none;}
    details p{
      color: var(--muted);
      margin: 10px 0 0;
      font-size: 13.5px;
    }

    footer{
      margin-top: 22px;
      color: rgba(255,255,255,0.55);
      font-size: 12.5px;
      text-align:center;
    }
    .toast{
      margin-top: 10px;
      font-size: 12.5px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Monthly Dividend Income Calculator</h1>
        <p class="sub">
          Use this <strong>monthly dividend income calculator</strong> to estimate how much <strong>dividend income</strong> you can earn from your investments in the <strong>United States or Canada</strong>.
          Enter your investment amount, dividend yield, and payout frequency to calculate <strong>monthly and annual dividend income</strong> instantly.
        </p>
      </div>

      <div class="pillRow">
        <div class="pill" aria-label="Mode">
          <label>Mode</label>
          <div class="seg" role="tablist" aria-label="Simple or Advanced">
            <button id="modeSimple" class="active" type="button" role="tab" aria-selected="true">Simple</button>
            <button id="modeAdvanced" type="button" role="tab" aria-selected="false">Advanced</button>
          </div>
        </div>

        <div class="pill" aria-label="Currency">
          <label>Currency</label>
          <div class="seg" role="tablist" aria-label="USD or CAD">
            <button id="curUSD" class="active" type="button" role="tab" aria-selected="true">USD</button>
            <button id="curCAD" type="button" role="tab" aria-selected="false">CAD</button>
          </div>
        </div>

        <div class="pill" aria-label="Goal view">
          <label>View</label>
          <div class="seg" role="tablist" aria-label="Estimate or Goal">
            <button id="viewEstimate" class="active" type="button" role="tab" aria-selected="true">Estimate</button>
            <button id="viewGoal" type="button" role="tab" aria-selected="false">Goal</button>
          </div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- =========================
           LEFT: CALCULATOR
      ========================== -->
      <section class="card" aria-label="Dividend Calculator">
        <div class="cardHead">
          <h2>Calculator</h2>
          <span class="badge" id="badgeContext">Simple • Estimate • USD</span>
        </div>

        <div class="content">
          <div class="form" id="simpleForm">
            <div class="field">
              <label for="investment">Total Investment Amount</label>
              <input id="investment" type="text" inputmode="decimal" placeholder="100,000" />
              <div class="helper">Enter the total amount invested in dividend-paying stocks/ETFs.</div>
            </div>

            <div class="field" id="goalField" style="display:none;">
              <label for="goalMonthly">Monthly Income Goal</label>
              <input id="goalMonthly" type="text" inputmode="decimal" placeholder="1,000" />
              <div class="helper">Goal mode: we’ll estimate the investment needed to reach this monthly income.</div>
            </div>

            <div class="field">
              <label for="yieldPct">Expected Dividend Yield (%)</label>
              <div class="inRow">
                <input id="yieldPct" type="number" min="0" step="0.01" value="5" />
              </div>
              <div class="helper">Example: 5% means $5 per year for every $100 invested (before taxes).</div>
            </div>

            <div class="field">
              <label for="frequency">Dividend Frequency</label>
              <select id="frequency">
                <option value="monthly">Monthly</option>
                <option value="quarterly" selected>Quarterly</option>
                <option value="semiannual">Semi-Annual</option>
                <option value="annual">Annual</option>
              </select>
              <div class="helper">Used to estimate per-payment amounts.</div>
            </div>

            <div class="field">
              <label>Quick Presets</label>
              <div class="btnRow">
                <button class="btn" type="button" data-preset="3">Conservative (3%)</button>
                <button class="btn" type="button" data-preset="5">Balanced (5%)</button>
                <button class="btn" type="button" data-preset="7">High Income (7%)</button>
              </div>
              <div class="helper">Presets change the dividend yield input.</div>
            </div>

            <div class="field">
              <label>Actions</label>
              <div class="btnRow">
                <button class="btn primary" id="btnCalculate" type="button">Calculate</button>
                <button class="btn ghost" id="btnReset" type="button">Reset</button>
              </div>
              <div class="helper">Auto-updates as you type (Calculate is just for clarity).</div>
            </div>
          </div>

          <!-- Advanced Options -->
          <div class="advanced" id="advancedPanel" aria-label="Advanced Options">
            <div class="form">
              <div class="field">
                <label for="drip">Dividend Reinvestment (DRIP)</label>
                <select id="drip">
                  <option value="off" selected>Off (cash income focus)</option>
                  <option value="on">On (reinvest dividends)</option>
                </select>
                <div class="helper">DRIP increases long-term growth, but cash income can be shown pre/post reinvestment.</div>
              </div>

              <div class="field">
                <label for="years">Time Horizon (Years)</label>
                <input id="years" type="number" min="1" step="1" value="10" />
                <div class="helper">How many years to simulate in Advanced Mode.</div>
              </div>

              <div class="field">
                <label for="divGrowth">Dividend Growth Rate (%/year)</label>
                <input id="divGrowth" type="number" min="0" step="0.01" value="3" />
                <div class="helper">Optional: assume dividend yield (income rate) grows by this percent each year.</div>
              </div>

              <div class="field">
                <label for="annualAdd">Annual Contribution (Optional)</label>
                <input id="annualAdd" type="text" inputmode="decimal" placeholder="5,000" />
                <div class="helper">Add money each year (e.g., new investments). Leave blank for $0.</div>
              </div>

              <div class="field">
                <label for="taxRate">Estimated Tax Rate (Optional %)</label>
                <input id="taxRate" type="number" min="0" max="100" step="0.01" placeholder="e.g., 15" />
                <div class="helper">Optional estimate for after-tax income (not tax advice).</div>
              </div>

              <div class="field">
                <label for="showTable">Show Year-by-Year Table</label>
                <select id="showTable">
                  <option value="off" selected>Off</option>
                  <option value="on">On</option>
                </select>
                <div class="helper">Table helps planning, but can be heavy on mobile—keep off by default.</div>
              </div>
            </div>
          </div>

          <!-- Results -->
          <div class="resultGrid" aria-label="Results">
            <div class="resultCard">
              <div class="resultLabel" id="r1Label">Estimated Monthly Dividend Income</div>
              <div class="resultValue" id="monthlyOut">—</div>
              <div class="resultNote" id="monthlyNote">Based on your inputs.</div>
            </div>

            <div class="resultCard">
              <div class="resultLabel" id="r2Label">Estimated Annual Dividend Income</div>
              <div class="resultValue" id="annualOut">—</div>
              <div class="resultNote" id="annualNote">Assumes yield stays constant.</div>
            </div>

            <div class="resultCard">
              <div class="resultLabel" id="r3Label">Estimated Per-Payment Dividend</div>
              <div class="resultValue" id="payOut">—</div>
              <div class="resultNote" id="payNote">Depends on payout frequency.</div>
            </div>

            <div class="resultCard">
              <div class="resultLabel" id="r4Label">Investment Needed for Your Goal</div>
              <div class="resultValue" id="needOut">—</div>
              <div class="resultNote" id="needNote">Only shown in Goal view.</div>
            </div>
          </div>

          <p class="mutedBlock" id="resultExplain">
            Your results show an estimated <strong>monthly dividend income</strong> and <strong>annual dividend income</strong> based on your inputs.
            These are estimates and assume the dividend yield remains stable. Actual dividends can change with market conditions and dividend policy.
          </p>

          <div class="tableWrap" id="tableWrap" style="display:none;">
            <table aria-label="Year-by-Year Simulation">
              <thead>
                <tr>
                  <th>Year</th>
                  <th>Start Balance</th>
                  <th>Yield Used</th>
                  <th>Dividends (Year)</th>
                  <th>After-Tax Dividends</th>
                  <th>Contribution</th>
                  <th>End Balance</th>
                  <th>Monthly Income (End)</th>
                </tr>
              </thead>
              <tbody id="simBody"></tbody>
            </table>
          </div>

          <div class="toast" id="hintText">
            Tip: In Advanced Mode, turn on DRIP + a dividend growth rate to model long-term compounding.
          </div>
        </div>
      </section>

      <!-- =========================
           RIGHT: EXPLANATION + FAQ
      ========================== -->
      <aside class="card" aria-label="Guide & FAQs">
        <div class="cardHead">
          <h2>How it Works</h2>
          <span class="tiny">SEO-friendly explanation</span>
        </div>
        <div class="content">
          <p class="sub" style="margin-top:0;">
            Dividend income is generated when companies or funds distribute a portion of profits to investors.
            Your total dividend income depends on your investment amount, the dividend yield, and payout frequency.
            This calculator helps you understand how those factors combine to produce monthly and yearly income.
          </p>

          <details open>
            <summary>Quick Formula</summary>
            <p>
              Annual dividend income ≈ Investment × (Dividend Yield ÷ 100).<br/>
              Monthly dividend income ≈ Annual ÷ 12.
            </p>
          </details>

          <details>
            <summary>Frequency & Per-Payment Estimates</summary>
            <p>
              If dividends pay quarterly, your per-payment amount is roughly annual income ÷ 4 (similar for monthly, semi-annual, annual).
              Real payouts may not be perfectly even.
            </p>
          </details>

          <details>
            <summary>Advanced Mode (DRIP + Growth + Contributions)</summary>
            <p>
              Advanced Mode can simulate reinvesting dividends (DRIP), adding money each year, and increasing income using a dividend growth rate.
              Use it to plan goals like $500 or $1,000 per month in dividends.
            </p>
          </details>

          <h2 style="margin:18px 0 10px; font-size:16px;">FAQ</h2>

          <details>
            <summary>How is monthly dividend income calculated?</summary>
            <p>
              Monthly dividend income is estimated by multiplying your investment amount by the annual dividend yield and dividing by 12.
              The calculator can also show a per-payment estimate using your chosen payout frequency.
            </p>
          </details>

          <details>
            <summary>How much should I invest to earn $1,000 per month in dividends?</summary>
            <p>
              $1,000/month is $12,000/year. Required investment ≈ $12,000 ÷ (yield as a decimal).
              Example: 6% yield → $12,000 ÷ 0.06 = $200,000.
            </p>
          </details>

          <details>
            <summary>Is dividend income taxable in the US and Canada?</summary>
            <p>
              Often yes, but it depends on account type (registered vs taxable), rules, and your situation.
              The optional tax input is only an estimate and not tax advice.
            </p>
          </details>

          <details>
            <summary>What is a good dividend yield?</summary>
            <p>
              Many investors look at 3%–7% as a common range, but sustainability matters more than yield.
              Very high yields can be riskier or unstable.
            </p>
          </details>

          <details>
            <summary>Does this calculator include dividend reinvestment (DRIP)?</summary>
            <p>
              Yes—Advanced Mode can simulate reinvestment. DRIP improves long-term compounding but reduces immediate cash income
              if you reinvest everything.
            </p>
          </details>

          <p class="mutedBlock">
            Want to plan specific income goals? Next you can add supporting pages like:
            <em>“How Much Should I Invest for $1,000 Monthly Dividends?”</em> and link them back to this calculator.
          </p>
        </div>
      </aside>
    </div>

    <footer>
      Disclaimer: Estimates only. Dividend yields, payouts, taxes, and market conditions can change. This tool is educational, not financial advice.
    </footer>
  </div>

<script>
/* =========================
   Helpers
========================= */
function toNumber(val){
  if(val === null || val === undefined) return 0;
  const s = String(val).replace(/[^0-9.-]/g,'');
  const n = Number(s);
  return isFinite(n) ? n : 0;
}
function formatMoney(n, currency){
  const sign = n < 0 ? "-" : "";
  const abs = Math.abs(n);
  // If user runs this offline, Intl exists in modern browsers.
  const cur = currency === "CAD" ? "CAD" : "USD";
  try{
    return sign + new Intl.NumberFormat(undefined, { style:"currency", currency: cur, maximumFractionDigits: 2 }).format(abs);
  }catch(e){
    return sign + (cur === "CAD" ? "C$" : "$") + abs.toFixed(2);
  }
}
function formatPct(n){
  if(!isFinite(n)) return "—";
  return n.toFixed(2) + "%";
}
function freqDivisor(freq){
  switch(freq){
    case "monthly": return 12;
    case "quarterly": return 4;
    case "semiannual": return 2;
    case "annual": return 1;
    default: return 4;
  }
}

/* =========================
   State
========================= */
let state = {
  mode: "simple",       // simple | advanced
  currency: "USD",      // USD | CAD
  view: "estimate"      // estimate | goal
};

/* =========================
   Elements
========================= */
const el = {
  modeSimple: document.getElementById("modeSimple"),
  modeAdvanced: document.getElementById("modeAdvanced"),
  curUSD: document.getElementById("curUSD"),
  curCAD: document.getElementById("curCAD"),
  viewEstimate: document.getElementById("viewEstimate"),
  viewGoal: document.getElementById("viewGoal"),
  badge: document.getElementById("badgeContext"),

  investment: document.getElementById("investment"),
  goalMonthly: document.getElementById("goalMonthly"),
  yieldPct: document.getElementById("yieldPct"),
  frequency: document.getElementById("frequency"),
  goalField: document.getElementById("goalField"),

  advancedPanel: document.getElementById("advancedPanel"),
  drip: document.getElementById("drip"),
  years: document.getElementById("years"),
  divGrowth: document.getElementById("divGrowth"),
  annualAdd: document.getElementById("annualAdd"),
  taxRate: document.getElementById("taxRate"),
  showTable: document.getElementById("showTable"),

  btnCalculate: document.getElementById("btnCalculate"),
  btnReset: document.getElementById("btnReset"),

  monthlyOut: document.getElementById("monthlyOut"),
  annualOut: document.getElementById("annualOut"),
  payOut: document.getElementById("payOut"),
  needOut: document.getElementById("needOut"),

  r4Label: document.getElementById("r4Label"),
  needNote: document.getElementById("needNote"),

  tableWrap: document.getElementById("tableWrap"),
  simBody: document.getElementById("simBody"),
};

/* =========================
   UI Toggles
========================= */
function setActive(segButtons, activeBtn){
  segButtons.forEach(b => b.classList.remove("active"));
  activeBtn.classList.add("active");
}
function updateBadge(){
  const m = state.mode === "advanced" ? "Advanced" : "Simple";
  const v = state.view === "goal" ? "Goal" : "Estimate";
  el.badge.textContent = `${m} • ${v} • ${state.currency}`;
}
function setMode(mode){
  state.mode = mode;
  setActive([el.modeSimple, el.modeAdvanced], mode === "simple" ? el.modeSimple : el.modeAdvanced);
  el.modeSimple.setAttribute("aria-selected", mode === "simple" ? "true" : "false");
  el.modeAdvanced.setAttribute("aria-selected", mode === "advanced" ? "true" : "false");

  if(mode === "advanced") el.advancedPanel.classList.add("on");
  else el.advancedPanel.classList.remove("on");

  updateBadge();
  calculate();
}
function setCurrency(cur){
  state.currency = cur;
  setActive([el.curUSD, el.curCAD], cur === "USD" ? el.curUSD : el.curCAD);
  el.curUSD.setAttribute("aria-selected", cur === "USD" ? "true" : "false");
  el.curCAD.setAttribute("aria-selected", cur === "CAD" ? "true" : "false");
  updateBadge();
  calculate();
}
function setView(view){
  state.view = view;
  setActive([el.viewEstimate, el.viewGoal], view === "estimate" ? el.viewEstimate : el.viewGoal);
  el.viewEstimate.setAttribute("aria-selected", view === "estimate" ? "true" : "false");
  el.viewGoal.setAttribute("aria-selected", view === "goal" ? "true" : "false");

  el.goalField.style.display = (view === "goal") ? "block" : "none";
  // When goal view is ON, investment can still be used for estimating, but "needed" will be highlighted.
  el.r4Label.textContent = view === "goal" ? "Investment Needed for Your Goal" : "Investment Needed for Your Goal";
  el.needNote.textContent = view === "goal" ? "Calculated from goal, yield, frequency." : "Only shown in Goal view.";
  updateBadge();
  calculate();
}

/* =========================
   Core Calculations
========================= */
function baseIncomeFromInvestment(investment, yieldPct){
  const y = Math.max(0, yieldPct) / 100;
  const annual = investment * y;
  const monthly = annual / 12;
  return { annual, monthly };
}

function investmentNeededForGoal(goalMonthly, yieldPct){
  const y = Math.max(0, yieldPct) / 100;
  if(y <= 0) return Infinity;
  const annualGoal = goalMonthly * 12;
  return annualGoal / y;
}

/**
 * Advanced simulation:
 * - Start with current investment (or needed investment if goal view and investment is empty)
 * - Each year:
 *    - dividends = balance * (yieldUsed)
 *    - optional tax applied to dividends
 *    - if DRIP on, after-tax dividends reinvested (added to balance)
 *    - annual contribution added
 *    - yieldUsed increases by dividend growth rate each year (optional)
 */
function simulateAdvanced({
  startBalance,
  yieldPct,
  years,
  divGrowthPct,
  annualAdd,
  dripOn,
  taxRatePct
}){
  const rows = [];
  let bal = Math.max(0, startBalance);
  let y = Math.max(0, yieldPct) / 100;
  const g = Math.max(0, divGrowthPct) / 100;
  const add = Math.max(0, annualAdd);
  const tax = (taxRatePct === null || taxRatePct === undefined || taxRatePct === "") ? null : Math.min(100, Math.max(0, Number(taxRatePct))) / 100;

  for(let yr=1; yr<=years; yr++){
    const start = bal;
    const dividends = start * y;
    const afterTax = (tax === null) ? dividends : dividends * (1 - tax);
    const reinvest = dripOn ? afterTax : 0;
    const end = start + reinvest + add;
    const monthlyIncomeEnd = (end * y) / 12; // income based on end balance and current yield
    rows.push({
      year: yr,
      start,
      yieldUsed: y,
      dividends,
      afterTax,
      contribution: add,
      end,
      monthlyIncomeEnd
    });
    bal = end;
    y = y * (1 + g);
  }
  return rows;
}

function calculate(){
  // Inputs
  const inv = toNumber(el.investment.value);
  const yPct = Number(el.yieldPct.value || 0);
  const freq = el.frequency.value;

  const goalMonthly = toNumber(el.goalMonthly.value);

  // Estimate mode results based on inv
  const base = baseIncomeFromInvestment(inv, yPct);

  // Per-payment estimate
  const divs = freqDivisor(freq);
  const perPay = base.annual / divs;

  // Goal view: investment needed for goalMonthly
  let needed = null;
  if(state.view === "goal" && goalMonthly > 0){
    needed = investmentNeededForGoal(goalMonthly, yPct);
  }

  // Update simple outputs
  el.monthlyOut.textContent = formatMoney(base.monthly, state.currency);
  el.annualOut.textContent = formatMoney(base.annual, state.currency);
  el.payOut.textContent = isFinite(perPay) ? formatMoney(perPay, state.currency) : "—";

  if(state.view === "goal"){
    el.needOut.textContent = (needed === null) ? "—" : (isFinite(needed) ? formatMoney(needed, state.currency) : "—");
  } else {
    el.needOut.textContent = "—";
  }

  // Advanced calculations & table
  if(state.mode === "advanced"){
    const dripOn = el.drip.value === "on";
    const years = Math.max(1, Math.floor(Number(el.years.value || 1)));
    const gPct = Number(el.divGrowth.value || 0);
    const add = toNumber(el.annualAdd.value);
    const tax = el.taxRate.value;

    // Choose start balance:
    // - If user is in goal view and investment is empty/0, use needed (if valid)
    // - Otherwise use investment
    let startBalance = inv;
    if(state.view === "goal" && (startBalance <= 0) && needed !== null && isFinite(needed)){
      startBalance = needed;
    }

    const rows = simulateAdvanced({
      startBalance,
      yieldPct: yPct,
      years,
      divGrowthPct: gPct,
      annualAdd: add,
      dripOn,
      taxRatePct: tax
    });

    // Show table if requested
    const show = el.showTable.value === "on";
    el.tableWrap.style.display = show ? "block" : "none";
    if(show){
      el.simBody.innerHTML = rows.map(r => `
        <tr>
          <td>${r.year}</td>
          <td>${formatMoney(r.start, state.currency)}</td>
          <td>${formatPct(r.yieldUsed*100)}</td>
          <td>${formatMoney(r.dividends, state.currency)}</td>
          <td>${formatMoney(r.afterTax, state.currency)}</td>
          <td>${formatMoney(r.contribution, state.currency)}</td>
          <td>${formatMoney(r.end, state.currency)}</td>
          <td>${formatMoney(r.monthlyIncomeEnd, state.currency)}</td>
        </tr>
      `).join("");
    }

    // In advanced mode, update headline results to reflect year 1 + end-of-horizon (optional)
    // Keep it simple: show Year-1 monthly/annual (already shown from inv), but if user wants, they can see the table.
    // You can later customize this to show "End of horizon monthly income" in one of the cards.
  } else {
    el.tableWrap.style.display = "none";
  }
}

/* =========================
   Reset + Presets + Listeners
========================= */
function resetAll(){
  el.investment.value = "";
  el.goalMonthly.value = "";
  el.yieldPct.value = 5;
  el.frequency.value = "quarterly";

  // advanced defaults
  el.drip.value = "off";
  el.years.value = 10;
  el.divGrowth.value = 3;
  el.annualAdd.value = "";
  el.taxRate.value = "";
  el.showTable.value = "off";
  el.tableWrap.style.display = "none";
  calculate();
}

document.querySelectorAll("[data-preset]").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    el.yieldPct.value = Number(btn.getAttribute("data-preset"));
    calculate();
  });
});

// Toggles
el.modeSimple.addEventListener("click", ()=>setMode("simple"));
el.modeAdvanced.addEventListener("click", ()=>setMode("advanced"));
el.curUSD.addEventListener("click", ()=>setCurrency("USD"));
el.curCAD.addEventListener("click", ()=>setCurrency("CAD"));
el.viewEstimate.addEventListener("click", ()=>setView("estimate"));
el.viewGoal.addEventListener("click", ()=>setView("goal"));

// Inputs auto-recalc
[
  el.investment, el.goalMonthly, el.yieldPct, el.frequency,
  el.drip, el.years, el.divGrowth, el.annualAdd, el.taxRate, el.showTable
].forEach(node=>{
  node.addEventListener("input", calculate);
  node.addEventListener("change", calculate);
});

el.btnCalculate.addEventListener("click", calculate);
el.btnReset.addEventListener("click", resetAll);

// Initialize
updateBadge();
resetAll();
</script>
</body>
</html>

